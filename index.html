<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
	<head>
	<title>WS修論システム</title>
	<meta http-equiv="Content-Style-Type" content="text/css" />
	<meta http-equiv="content-script-type" content="text/javascript" />
	
<!-- --------------------CSS部分-------------------- -->
<style>
body {
	font-family: "Helvetica Neue", helvetica, arial;
	padding: 15px;
}
div.box_part{
	width: 400px;
	float: right;
}
div.device_part{
	width: 300px;
	float: left;
}
div.chatbox{
	border-style: solid;
	border-color: gray;
}
div.logbox{
	border-style: solid;
	border-color: gray;
}
div.pingbox{
	border-style: solid;
	border-color: gray;
}
</style>
<!-- --------------------CSS部分-------------------- -->


<!-- --------------------スクリプト部分-------------------- -->
<script>

//変数定義(websocket必須)
var host = location.origin.replace(/^http/, 'ws');			//host
var ws = new WebSocket(host);								//websocket
//付け加え変数定義
var message, ping_fld, chat_ipt, chat_fld;					//メッセージ、pingボックス、log入力、logボックス
var userid = 'ユーザ' + Math.floor(Math.random() * 500);	//ユーザIDをランダムで生成

//**********オープン処理**********
ws.onopen = function(){
//	ws.send("open");
	ws.send(JSON.stringify({
		user:userid,
		type:'connect'
//		text:'open'
	}));
}

//**********クローズイベント**********
//ws.onclose = function(){
//	ws.send("close");
//}


//**********サーバからデータ受信時のmessageイベント**********
ws.onmessage = function (event) {

	//メッセージの代入
	var messages = JSON.parse(event.data);

	
	console.log(messages);
	console.log(messages.type);
	if(messages.type === "connect"){
		console.log(messages.user + " のタイプはconnect");
	}

	//変数に値代入
	ping_fld = document.getElementById("ping_field");
	chat_ipt = document.getElementById("chat_input");
	chat_fld = document.getElementById("chat_field");
	
	//openメッセージ
	if(JSON.parse(event.data) == "open"){
		chat_fld.innerHTML += "device opened<br>";
	//closeメッセージ
	} else if(JSON.parse(event.data) == "close"){
		chat_fld.innerHTML += "device closed<br>";
	//デバイス登録イベント
	} else if(JSON.parse(event.data) == "PC.1"){
		document.getElementById("con_pc1").innerHTML = "PC.1";
		chat_fld.innerHTML += "PC1 登録完了" + "<br>";
	} else if(JSON.parse(event.data) == "PC.2"){
		document.getElementById("con_pc2").innerHTML = "PC.2";
		chat_fld.innerHTML += "PC2 登録完了" + "<br>";
	} else if(JSON.parse(event.data) == "PC.3"){
		document.getElementById("con_pc3").innerHTML = "PC.3";
		chat_fld.innerHTML += "PC3 登録完了" + "<br>";
	} else if(JSON.parse(event.data) == "TABLET.1"){
		document.getElementById("con_tablet1").innerHTML = "TABLET.1";
		chat_fld.innerHTML += "TABLET1 登録完了" + "<br>";
	} else if(JSON.parse(event.data) == "TABLET.2"){
		document.getElementById("con_tablet2").innerHTML = "TABLET.2";
		chat_fld.innerHTML += "TABLET2 登録完了" + "<br>";
	} else if(JSON.parse(event.data) == "TABLET.3"){
		document.getElementById("con_tablet3").innerHTML = "TABLET.3";
		chat_fld.innerHTML += "TABLET3 登録完了" + "<br>";
	} else {
	//pingメッセージ
	ping_fld.innerHTML += JSON.parse(event.data) + "<br>";
//	console.log(JSON.parse(event.data));
	}
};

	

//**********ログ入力の送信ボタンイベント**********
function send() {
	//サーバに送信
	chat_ipt = document.getElementById("chat_input");
	var chattext = chat_ipt.value + "<br>";
	chat_fld = document.getElementById("chat_field");
	
//	通信ありで送信したい場合
	ws.send(chattext);
//	通信なしで送信したい場合
//	chat_fld.innerHTML += chattext;
	console.log("inputからメッセージを送信" + chattext);
}


var num_dvc;	//自デバイスの値

	//**********デバイス登録ボタンイベント**********
function onDeviceRadioButton(){
	//定義
	var pc1 = document.getElementById("pc1").checked;
	var pc2 = document.getElementById("pc2").checked;
	var pc3 = document.getElementById("pc3").checked;
	var tablet1 = document.getElementById("tablet1").checked;
	var tablet2 = document.getElementById("tablet2").checked;
	var tablet3 = document.getElementById("tablet3").checked;

	
	//値の代入
	if(pc1==true){
		num_dvc = "PC.1";
		document.getElementById("con_pc1").innerHTML = num_dvc;			//デバイス通信状況に
	} else if(pc2==true){
		num_dvc = "PC.2";
		document.getElementById("con_pc2").innerHTML = num_dvc;			//デバイス通信状況に
	} else if(pc3==true){
		num_dvc = "PC.3";
		document.getElementById("con_pc3").innerHTML = num_dvc;			//デバイス通信状況に
	} else if(tablet1==true){
		num_dvc = "TABLET.1";
		document.getElementById("con_tablet1").innerHTML = num_dvc;		//デバイス通信状況に
	} else if(tablet2==true){
		num_dvc = "TABLET.2";
		document.getElementById("con_tablet2").innerHTML = num_dvc;		//デバイス通信状況に
	} else if(tablet3==true){
		num_dvc = "TABLET.3";
		document.getElementById("con_tablet3").innerHTML = num_dvc;		//デバイス通信状況に
	}
	
	document.getElementById("my_device_status").innerHTML = num_dvc;	//デバイス状態に
	
	//他のデバイスにも自身の状態を送信
	ws.send(num_dvc);
}
</script>
<!-- スクリプト部分終わり -->




</head>
<body>
	<!-- **********タイトル********** -->
	<div class="title_part">
		<h1>WebSocket修論システム</h1>
	</div>
	<!-- **********タイトルend********** -->	
	
	<!-- **********ボックス********** -->
	<div class="box_part">
		<!-- デバッグ用チャット部分 -->
		<div class="chat_part">
			--デバッグ用チャット部分--<br>
			<input type="text" id="chat_input"/>
			<input type="button" id="chat_button" value="send" onclick="send()"/>
			<br>
			<div class="chatbox" id="chat_field" style="height:100px; width:350px; overflow-y:scroll;">
			</div>
			<br><br>
		</div>

		<!-- 接続ログ部分 -->
		<div class="log_part">
			---ログ部分---<br>
			<div class="logbox" id="log_field" style="height:100px; width:350px; overflow-y:scroll;">
			</div>
			<br><br>
		</div>
	
		<!-- ping部分:通信を切らないために -->
		<div class="ping_part">
			---PINGBOX ＜ 通信を切らないために ＞---<br>
			<div class="pingbox" id="ping_field" style="height:100px; width:350px; overflow-y:scroll;">
			</div>
		</div>
		<br>
	</div>
	<!-- **********ボックスend********** -->
	
	<!-- **********デバイス・通信********** -->
	<div class="device_part">
		
		<!-- 自身の接続ステータス部分 -->
		<div class="my_connect_status_part">
			接続状態：　<nobr id="my_connect_status">未接続</nobr>
			<br>
		</div>
		
		<!-- デバイス登録部分 -->
		<div class="device_regist_part">
			デバイス登録：<br>
			<!-- 登録ボタン、変更ボタン -->
			<button name="button_regist_device" value="regist_device" onclick="onDeviceRadioButton();">デバイス登録</button>
			<button name="button_change_device" value="change_device" onclick="onDeviceChangeRadioButton()">デバイス変更</button><br/>
			<!-- デバイス選択ラジオボタン -->
			<form>
				<input type="radio" name="device" id="pc1" value="pc1"/><label for="pc1">PC1</label>
				<input type="radio" name="device" id="pc2" value="pc2"/><label for="pc2">PC2</label>
				<input type="radio" name="device" id="pc3" value="pc3"/><label for="pc3">PC3</label><br/>
				<input type="radio" name="device" id="tablet1" value="tablet1"/><label for="tablet1">Tablet1</label>
				<input type="radio" name="device" id="tablet2" value="tablet2"/><label for="tablet2">Tablet2</label>
				<input type="radio" name="device" id="tablet3" value="tablet3"/><label for="tablet3">Tablet3</label>
			</form>
			<br>
		</div>
		
		<!-- 自身のデバイスステータス部分 -->
		<div class="my_device_status_part">
			This PC ステータス：　<nobr id="my_device_status">未登録</nobr>
			<br>
		</div>
		
		<!-- 全体デバイスステータス部分 -->
		<div class="connect_part">
			---デバイス通信状況---<br>
			パソコン1：<font color="red" id="con_pc1">未接続</font><br>
			パソコン2：<font color="red" id="con_pc2">未接続</font><br>
			パソコン3：<font color="red" id="con_pc3">未接続</font><br>
			タブレット1：<font color="red" id="con_tablet1">未接続</font><br>
			タブレット2：<font color="red" id="con_tablet2">未接続</font><br>
			タブレット3：<font color="red" id="con_tablet3">未接続</font><br>
		</div>
		
		<!-- Kinect接続部分 -->

		<br>
	</div>
	<!-- **********デバイス・通信end********** -->
	
	<!-- **********台本・稽古********** -->
	
	<!-- 台本登録部分 -->
	
	
	<!-- 稽古操作部分 -->
	
	
	<!-- 稽古進行状況部分 -->
	
	
	<!-- **********台本・稽古end********** -->
	
  </body>
</html>
