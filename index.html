<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
	<head>
	<title>WS修論システム</title>
	<meta http-equiv="Content-Style-Type" content="text/css" />
	<meta http-equiv="content-script-type" content="text/javascript" />
	
<!-- CSS部分 -->
<style>
body {
	font-family: "Helvetica Neue", helvetica, arial;
	padding: 15px;
}
div.pingbox{
	border-style: solid;
	border-color: gray;
}
div.logbox{
	border-style: solid;
	border-color: gray;
}
</style>
<!-- CSS部分 -->


<!-- スクリプト部分 -->
<script>

//変数定義(websocket必須)
var host = location.origin.replace(/^http/, 'ws')			//host
var ws = new WebSocket(host);								//websocket
//付け加え変数定義
var ping_msg, log_ipt, log_fld;								//pingボックス、log入力、logボックス
var userid = 'ユーザ' + Math.floor(Math.random() * 500);	//ユーザIDをランダムで生成

//オープン処理
ws.onopen = function(){
	ws.send("open");
}

//サーバからデータ受信時のmessageイベント
ws.onmessage = function (event) {
	ping_msg = document.getElementById("ping_message");
	log_ipt = document.getElementById("log_input");
	log_fld = document.getElementById("log_field");
	
	//openメッセージ
	if(JSON.parse(event.data) == "open"){
		log_fld.innerHTML += "device opened<br>";
		
	//デバイス登録イベント
	} else if(JSON.parse(event.data) == "PC.1"){
		document.getElementById("com_pc1").innerHTML = "PC.1";
		log_fld.innerHTML += "PC1 登録完了" + "<br>";
	} else if(JSON.parse(event.data) == "PC.2"){
		document.getElementById("com_pc2").innerHTML = "PC.2";
		log_fld.innerHTML += "PC2 登録完了" + "<br>";
	} else if(JSON.parse(event.data) == "PC.3"){
		document.getElementById("com_pc3").innerHTML = "PC.3";
		log_fld.innerHTML += "PC3 登録完了" + "<br>";
	} else if(JSON.parse(event.data) == "TABLET.1"){
		document.getElementById("com_tablet1").innerHTML = "TABLET.1";
		log_fld.innerHTML += "TABLET1 登録完了" + "<br>";
	} else if(JSON.parse(event.data) == "TABLET.2"){
		document.getElementById("com_tablet2").innerHTML = "TABLET.2";
		log_fld.innerHTML += "TABLET2 登録完了" + "<br>";
	} else if(JSON.parse(event.data) == "TABLET.3"){
		document.getElementById("com_tablet3").innerHTML = "TABLET.3";
		log_fld.innerHTML += "TABLET3 登録完了" + "<br>";
	} else {
	//pingメッセージ
	ping_msg.innerHTML += JSON.parse(event.data) + "<br>";
	console.log(JSON.parse(event.data));
	}
};
	

//ログ入力の送信ボタンイベント
function send() {
	//サーバに送信
	log_ipt = document.getElementById("log_input");
	var logtext = log_ipt.value + "<br>";
	log_fld = document.getElementById("log_field");
	
//	通信ありで送信したい場合
	ws.send(logtext);
//	通信なしで送信したい場合
//	log_fld.innerHTML += logtext;
	console.log("inputからメッセージを送信" + logtext);
}


var num_dvc;

	//デバイス登録ボタンイベント
function onDeviceRadioButton(){
	//定義
	var pc1 = document.getElementById("pc1").checked;
	var pc2 = document.getElementById("pc2").checked;
	var pc3 = document.getElementById("pc3").checked;
	var tablet1 = document.getElementById("tablet1").checked;
	var tablet2 = document.getElementById("tablet2").checked;
	var tablet3 = document.getElementById("tablet3").checked;

	
	//値の代入
	if(pc1==true){
		num_dvc = "PC.1";
		document.getElementById("com_pc1").innerHTML = num_dvc;			//デバイス通信状況に
	} else if(pc2==true){
		num_dvc = "PC.2";
		document.getElementById("com_pc2").innerHTML = num_dvc;			//デバイス通信状況に
	} else if(pc3==true){
		num_dvc = "PC.3";
		document.getElementById("com_pc3").innerHTML = num_dvc;			//デバイス通信状況に
	} else if(tablet1==true){
		num_dvc = "TABLET.1";
		document.getElementById("com_tablet1").innerHTML = num_dvc;		//デバイス通信状況に
	} else if(tablet2==true){
		num_dvc = "TABLET.2";
		document.getElementById("com_tablet2").innerHTML = num_dvc;		//デバイス通信状況に
	} else if(tablet3==true){
		num_dvc = "TABLET.3";
		document.getElementById("com_tablet3").innerHTML = num_dvc;		//デバイス通信状況に
	}
	
	document.getElementById("my_device_status").innerHTML = num_dvc;	//デバイス状態に
	
	//他のデバイスにも自身の状態を送信
	ws.send(num_dvc);
}
</script>
<!-- スクリプト部分終わり -->




</head>
<body>
	<!-- タイトル -->
	<div class="title_part">
		<h1>WebSocket修論システム</h1>
	</div>

	<!-- log部分 -->
	<div class="log_part">
		---ログ部分---<br>
		<input type="text" id="log_input"/>
		<input type="button" id="log_button" value="send" onclick="send()"/>
		<br>
		<div class="logbox" id="log_field" style="height:100px; width:500px; overflow-y:scroll;">
		</div>
		<br><br>
	</div>
	
	<!-- 自分のステータス -->
	<div class="my_status_part">
		---ステータス---<br>
		<!-- 自分のステータス登録 -->
		<div class="my_status_regist">
			登録:<br>
			<button type="my_regist_device" name="button_regist_device" value="regist_device" onclick="onDeviceRadioButton();">デバイス登録</button>
			<button type="change_device" name="button_change_device" value="change_device" onclick="onDeviceChangeRadioButton()">デバイス変更</button><br/>
			<!-- デバイス選択ラジオボタン -->
			<form>
				<input type="radio" name="device" id="pc1" value="pc1"/><label for="pc1">PC1</label>
				<input type="radio" name="device" id="pc2" value="pc2"/><label for="pc2">PC2</label>
				<input type="radio" name="device" id="pc3" value="pc3"/><label for="pc3">PC3</label><br/>
				<input type="radio" name="device" id="tablet1" value="tablet1"/><label for="tablet1">Tablet1</label>
				<input type="radio" name="device" id="tablet2" value="tablet2"/><label for="tablet2">Tablet2</label>
				<input type="radio" name="device" id="tablet3" value="tablet3"/><label for="tablet3">Tablet3</label>
			</form>
		</div>
		
		<!-- 自分のステータス確認 -->
		<div class="my_status_check">
			状態:<br>
			デバイス：<nobr id="my_device_status">未登録</nobr><br>
			接続：<nobr id="my_connection">未登録</nobr><br>
		</div>
	</div>
	
	<!-- デバイス通信状況 -->
	<div class="communication_part">
		<br>---デバイス通信状況---<br>
		パソコン1：<font color="red" id="com_pc1">未接続</font><br>
		パソコン2：<font color="red" id="com_pc2">未接続</font><br>
		パソコン3：<font color="red" id="com_pc3">未接続</font><br>
		タブレット1：<font color="red" id="com_tablet1">未接続</font><br>
		タブレット2：<font color="red" id="com_tablet2">未接続</font><br>
		タブレット3：<font color="red" id="com_tablet3">未接続</font><br>
		<br>
	</div>
	

	<!-- pingボックス:通信を切らないために -->
	<div class="pingbox_part">
		---PINGBOX ＜ 通信を切らないために ＞---<br>
		<div class="pingbox" id="ping_message" style="height:100px; width:500px; overflow-y:scroll;">
			<!-- 表示したいテーブル<br>a<br>a<br>a<br>a<br>a<br>aaaa<br>aaaaa<br> -->
		</div>
	</div>
	
  </body>
</html>
